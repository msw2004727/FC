<!-- ============ ATTENDANCE NOTIFY MODAL ============ -->
<div class="scan-result-overlay" id="attendance-notify-modal">
  <div class="scan-result-box success">
    <div class="scan-result-icon" id="att-notify-icon"></div>
    <div class="scan-result-title" id="att-notify-title"></div>
    <div class="scan-result-name" id="att-notify-event"></div>
    <button class="scan-result-close" onclick="App.closeAttendanceNotify()">確定</button>
  </div>
</div>

<!-- ============ POPUP AD OVERLAY ============ -->
<div id="popup-ad-overlay" class="popup-ad-overlay" style="display:none" onclick="App.closePopupAd()">
  <div class="popup-ad-container" id="popup-ad-container" onclick="event.stopPropagation()">
    <div class="popup-ad-body" id="popup-ad-body"></div>
    <div class="popup-ad-footer">
      <span class="popup-ad-counter" id="popup-ad-counter"></span>
      <div class="popup-ad-footer-right">
        <button class="popup-ad-dismiss-btn" id="popup-ad-dismiss-btn" onclick="App.togglePopupDismiss()">點擊今日不再顯示</button>
        <button class="popup-ad-close" onclick="App.closePopupAd()">✕</button>
      </div>
    </div>
  </div>
</div>

<!-- UID QR Code Popup -->
<div id="uid-qr-modal" style="display:none;position:fixed;inset:0;z-index:1200;background:rgba(0,0,0,.5);backdrop-filter:blur(4px);align-items:center;justify-content:center" onclick="if(event.target===this)this.style.display='none'">
  <div style="background:var(--bg-card);border-radius:var(--radius-lg);max-width:320px;width:85%;padding:1.5rem;text-align:center;position:relative">
    <button style="position:absolute;top:.5rem;right:.7rem;background:none;border:none;font-size:1.2rem;cursor:pointer;color:var(--text-muted)" onclick="document.getElementById('uid-qr-modal').style.display='none'">✕</button>
    <div id="uid-qr-content"></div>
  </div>
</div>

<!-- Custom Confirm Modal -->
<div class="app-confirm-overlay" id="app-confirm-modal">
  <div class="app-confirm-box">
    <div class="app-confirm-msg" id="app-confirm-msg"></div>
    <div class="app-confirm-btns">
      <button class="app-confirm-cancel" id="app-confirm-cancel">取消</button>
      <button class="app-confirm-ok" id="app-confirm-ok">確定</button>
    </div>
  </div>
</div>

<!-- ============ 自訂層級刪除確認彈窗 ============ -->
<div class="modal-overlay" id="role-delete-overlay" style="display:none;align-items:center;justify-content:center" onclick="if(event.target===this){this.style.display='none';this.classList.remove('open')}">
  <div class="modal" style="max-width:320px;position:static;border-radius:var(--radius);transform:none">
    <div class="modal-header">
      <h3>確認刪除層級</h3>
      <button class="modal-close" onclick="var o=document.getElementById('role-delete-overlay');o.style.display='none';o.classList.remove('open')">✕</button>
    </div>
    <div class="modal-body">
      <p id="role-delete-msg" style="font-size:.85rem;line-height:1.6"></p>
    </div>
    <div class="modal-actions">
      <button class="outline-btn" onclick="var o=document.getElementById('role-delete-overlay');o.style.display='none';o.classList.remove('open')">取消</button>
      <button class="primary-btn" style="background:var(--danger)" id="role-delete-confirm-btn">確認刪除</button>
    </div>
  </div>
</div>

<!-- ============ 同行者新增/編輯 Modal ============ -->
<div class="modal-overlay" id="companion-modal-overlay" style="display:none;align-items:center;justify-content:center" onclick="if(event.target===this){App.closeCompanionModal()}">
  <div class="modal" style="max-width:340px;position:static;border-radius:var(--radius);transform:none">
    <div class="modal-header">
      <h3 id="companion-modal-title">新增同行者</h3>
      <button class="modal-close" onclick="App.closeCompanionModal()">✕</button>
    </div>
    <div class="modal-body">
      <input type="hidden" id="companion-modal-id">
      <div style="margin-bottom:.6rem">
        <label style="font-size:.8rem;font-weight:600;display:block;margin-bottom:.3rem">姓名 <span style="color:var(--danger)">*</span></label>
        <input type="text" id="companion-modal-name" maxlength="20" placeholder="輸入姓名" style="width:100%;padding:.5rem .7rem;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--bg-card);color:var(--text-primary);font-size:.85rem;box-sizing:border-box">
      </div>
      <div style="margin-bottom:.6rem">
        <label style="font-size:.8rem;font-weight:600;display:block;margin-bottom:.3rem">性別</label>
        <select id="companion-modal-gender" style="width:100%;padding:.5rem .7rem;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--bg-card);color:var(--text-primary);font-size:.85rem">
          <option value="">不填</option>
          <option value="男">男</option>
          <option value="女">女</option>
        </select>
      </div>
      <div>
        <label style="font-size:.8rem;font-weight:600;display:block;margin-bottom:.3rem">備註</label>
        <textarea id="companion-modal-notes" rows="2" maxlength="50" placeholder="例：家人、朋友（最多50字）" style="width:100%;padding:.5rem .7rem;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--bg-card);color:var(--text-primary);font-size:.85rem;resize:none;box-sizing:border-box"></textarea>
      </div>
    </div>
    <div class="modal-actions">
      <button class="outline-btn" onclick="App.closeCompanionModal()">取消</button>
      <button class="primary-btn" onclick="App.saveCompanion()">儲存</button>
    </div>
  </div>
</div>

<!-- ============ MODAL OVERLAY ============ -->
<div class="modal-overlay" id="modal-overlay"></div>

<!-- ============ 同行者選擇報名 Modal ============ -->
<div class="modal-overlay" id="companion-select-overlay" style="display:none;align-items:center;justify-content:center" onclick="if(event.target===this){App._closeCompanionSelectModal()}">
  <div class="modal" style="max-width:360px;position:static;border-radius:var(--radius);transform:none">
    <div class="modal-header">
      <h3>選擇參與者</h3>
      <button class="modal-close" onclick="App._closeCompanionSelectModal()">✕</button>
    </div>
    <div class="modal-body">
      <div id="companion-select-event-info" style="font-size:.8rem;color:var(--text-muted);margin-bottom:.7rem"></div>
      <div id="companion-select-list"></div>
      <div id="companion-select-summary" style="margin-top:.6rem;padding:.4rem .6rem;border:1px solid var(--border);border-radius:var(--radius-sm);font-size:.78rem;background:var(--bg-elevated);display:flex;gap:.8rem;flex-wrap:wrap"></div>
    </div>
    <div class="modal-actions">
      <button class="outline-btn" onclick="App._closeCompanionSelectModal()">取消</button>
      <button class="primary-btn" id="companion-select-confirm-btn" onclick="App._confirmCompanionRegister()">確認報名</button>
    </div>
  </div>
</div>

<!-- ============ 同行者取消報名 Modal ============ -->
<div class="modal-overlay" id="companion-cancel-overlay" style="display:none;align-items:center;justify-content:center" onclick="if(event.target===this){App._closeCompanionCancelModal()}">
  <div class="modal" style="max-width:360px;position:static;border-radius:var(--radius);transform:none">
    <div class="modal-header">
      <h3 id="companion-cancel-title">取消報名</h3>
      <button class="modal-close" onclick="App._closeCompanionCancelModal()">✕</button>
    </div>
    <div class="modal-body">
      <div style="font-size:.8rem;color:var(--text-muted);margin-bottom:.5rem">請選擇要取消的報名：</div>
      <div style="margin-bottom:.4rem"><button class="outline-btn" style="font-size:.75rem;padding:.2rem .6rem" onclick="App._selectAllCancelRegs()">全選</button></div>
      <div id="companion-cancel-list"></div>
    </div>
    <div class="modal-actions">
      <button class="outline-btn" onclick="App._closeCompanionCancelModal()">返回</button>
      <button class="primary-btn" style="background:var(--danger)" onclick="App._confirmCompanionCancel()">確認取消</button>
    </div>
  </div>
</div>

<!-- Confirm Modal -->
<div class="modal" id="confirm-modal">
  <div class="modal-header">
    <h3 id="confirm-title">確認操作</h3>
    <button class="modal-close" onclick="App.closeModal()">✕</button>
  </div>
  <div class="modal-body" id="confirm-body"></div>
  <div class="modal-actions">
    <button class="outline-btn" onclick="App.closeModal()">取消</button>
    <button class="primary-btn" onclick="App.closeModal()">確認</button>
  </div>
</div>

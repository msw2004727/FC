<!-- PAGE: Scan QR -->
<section class="page" id="page-scan" data-min-role="coach">
  <div class="page-header">
    <button class="back-btn" onclick="App.goBack()">←</button>
    <h2>掃碼簽到 / 簽退</h2>
  </div>
  <div class="scan-content">
    <select id="scan-event-select" class="scan-event-select">
      <option value="">— 請選擇活動 —</option>
    </select>
    <div class="scan-mode-toggle">
      <button class="scan-mode active" data-mode="checkin">簽到</button>
      <button class="scan-mode" data-mode="checkout">簽退</button>
    </div>
    <div class="scan-camera">
      <div class="scan-qr-reader" id="scan-qr-reader">
        <span style="color:var(--text-muted);font-size:.85rem;">點擊下方按鈕開啟相機</span>
      </div>
      <button class="scan-camera-btn" id="scan-camera-btn" disabled>開啟相機掃碼</button>
    </div>
    <!-- 手動輸入 UID 備援（相機失敗時顯示） -->
    <div id="scan-manual-section" style="display:none;margin-top:.8rem;padding:.6rem .8rem;border:1px solid var(--border);border-radius:var(--radius-sm);background:var(--bg-elevated)">
      <div style="font-size:.78rem;color:var(--text-muted);margin-bottom:.4rem">相機無法使用？可手動輸入用戶 UID：</div>
      <div style="display:flex;gap:.4rem">
        <input type="text" id="scan-manual-uid" placeholder="輸入用戶 UID" style="flex:1;padding:.35rem .5rem;border:1px solid var(--border);border-radius:var(--radius-sm);font-size:.85rem;background:var(--bg);color:var(--text-primary)">
        <button class="primary-btn" style="padding:.35rem .7rem;font-size:.82rem" onclick="App._processManualUid()">確認</button>
      </div>
    </div>
    <div class="scan-results" id="scan-results"></div>
    <div class="scan-stats" id="scan-stats"></div>
    <div id="scan-registered-section"></div>
    <div id="scan-unreg-section"></div>
  </div>
</section>

<!-- Scan result popup -->
<div class="scan-result-overlay" id="scan-result-modal">
  <div class="scan-result-box" id="scan-result-box">
    <div class="scan-result-icon" id="scan-result-icon"></div>
    <div class="scan-result-title" id="scan-result-title"></div>
    <div class="scan-result-name" id="scan-result-name"></div>
    <button class="scan-result-close" onclick="App.closeScanResult()">確認</button>
  </div>
</div>

<!-- Family checkin modal -->
<div class="scan-result-overlay" id="scan-family-modal">
  <div class="scan-result-box" style="max-width:360px;text-align:left">
    <div id="scan-family-title" style="font-weight:700;margin-bottom:.5rem"></div>
    <div id="scan-family-list"></div>
    <div style="display:flex;gap:.5rem;margin-top:.6rem">
      <button class="scan-result-close" style="flex:1;background:var(--border);color:var(--text-primary)" onclick="App._closeFamilyModal()">取消</button>
      <button class="scan-result-close" style="flex:1" id="scan-family-confirm-btn" onclick="App._confirmFamilyCheckin()">確認</button>
    </div>
  </div>
</div>


<!DOCTYPE html>
<html lang="zh-Hant" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>圖斯特Hub — 運動報名系統</title>
  <link rel="icon" href="data:,">
  <link rel="stylesheet" href="style.css?v=20260210">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <script>
    // 早期模式偵測：防止正式版重整時閃現 Demo 畫面
    (function(){
      var mode = localStorage.getItem('sporthub_mode') ||
        (location.hostname === 'msw2004727.github.io' ? 'production' : 'demo');
      if (mode !== 'demo') {
        document.documentElement.classList.add('prod-early');
      }
    })();
  </script>

  <!-- ============ TOP BAR ============ -->
  <header id="top-bar">
    <button id="menu-toggle" aria-label="選單">
      <span></span><span></span><span></span>
    </button>
    <div class="logo">
      <span class="logo-text">圖斯特Hub</span>
    </div>
    <div class="top-bar-right">
      <div class="sport-picker-wrapper" id="sport-picker-wrapper">
        <button class="sport-picker-btn" id="sport-picker-btn" aria-label="選擇運動類別">
          <span class="sport-picker-icon">⚽</span>
        </button>
        <div class="sport-picker-dropdown" id="sport-picker-dropdown">
          <div class="sport-picker-header">選擇運動類別</div>
          <button class="sport-picker-item active" data-sport="football">
            <span class="sp-icon">⚽</span><span>足球</span>
          </button>
          <button class="sport-picker-item locked" data-sport="basketball" disabled>
            <span class="sp-icon">🏀</span><span>籃球</span><span class="sp-lock">🔒</span>
          </button>
          <button class="sport-picker-item locked" data-sport="volleyball" disabled>
            <span class="sp-icon">🏐</span><span>排球</span><span class="sp-lock">🔒</span>
          </button>
          <button class="sport-picker-item locked" data-sport="tennis" disabled>
            <span class="sp-icon">🎾</span><span>網球</span><span class="sp-lock">🔒</span>
          </button>
          <button class="sport-picker-item locked" data-sport="badminton" disabled>
            <span class="sp-icon">🏸</span><span>羽球</span><span class="sp-lock">🔒</span>
          </button>
        </div>
      </div>
      <button id="notif-btn" aria-label="通知">
        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
        <span class="notif-badge" id="notif-badge" style="display:none"></span>
      </button>
      <div class="role-switcher-wrapper" id="role-switcher-wrapper" style="display:none">
        <button id="role-avatar-btn" class="role-avatar-btn" aria-label="切換身份">
          <div class="role-avatar">麥</div>
          <span class="role-current-label">一般用戶</span>
          <span class="role-arrow">▼</span>
        </button>
        <div id="role-dropdown" class="role-dropdown">
          <div class="role-dropdown-header">切換 Demo 身份</div>
          <button class="role-dropdown-item active" data-role="user">
            <span class="role-icon">U</span>
            <span>一般用戶</span>
          </button>
          <button class="role-dropdown-item" data-role="coach">
            <span class="role-icon">C</span>
            <span>教練</span>
          </button>
          <button class="role-dropdown-item" data-role="captain">
            <span class="role-icon">L</span>
            <span>領隊</span>
          </button>
          <button class="role-dropdown-item" data-role="venue_owner">
            <span class="role-icon">V</span>
            <span>場主</span>
          </button>
          <button class="role-dropdown-item" data-role="admin">
            <span class="role-icon">A</span>
            <span>管理員</span>
          </button>
          <button class="role-dropdown-item" data-role="super_admin">
            <span class="role-icon">S</span>
            <span>總管</span>
          </button>
        </div>
      </div>
      <div id="line-login-wrapper" class="line-login-wrapper" style="display:none">
        <button id="line-login-btn" class="line-login-btn" onclick="LineAuth.login()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="#fff"><path d="M12 2C6.48 2 2 5.83 2 10.5c0 4.18 3.66 7.68 8.58 8.38.33.07.78.22.9.5.1.26.07.66.03.92l-.15.86c-.04.26-.2 1.01.88.55s5.88-3.47 8.03-5.93C22.08 13.79 22 12.18 22 10.5 22 5.83 17.52 2 12 2z"/></svg>
          LINE 登入
        </button>
        <div id="line-user-topbar" class="line-user-topbar" style="display:none">
          <img id="line-avatar-topbar" class="line-avatar-topbar" src="" alt="" onclick="App.toggleUserMenu()">
          <div id="user-menu-dropdown" class="user-menu-dropdown" style="display:none">
            <div class="user-menu-name" id="user-menu-name"></div>
            <div class="user-menu-divider"></div>
            <button class="user-menu-item" onclick="App.showPage('page-profile'); App.toggleUserMenu()">我的資料</button>
            <button class="user-menu-item user-menu-logout" onclick="App.logoutLine()">登出</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- ============ SIDE DRAWER ============ -->
  <div id="drawer-overlay"></div>
  <nav id="side-drawer">
    <div class="drawer-header">
      <div class="drawer-user">
        <div class="drawer-avatar" id="drawer-avatar">麥</div>
        <div>
          <div class="drawer-name" id="drawer-name">冠軍.全勤.小麥</div>
          <div class="drawer-role-tag" id="drawer-role-tag">一般用戶</div>
        </div>
      </div>
    </div>
    <div class="drawer-menu" id="drawer-menu">
      <!-- Dynamically populated -->
    </div>
    <div class="drawer-footer">
      <button id="theme-toggle">
        <span class="theme-icon"></span>
        <span>深色模式</span>
        <div class="toggle-switch active"><div class="toggle-knob"></div></div>
      </button>
    </div>
  </nav>

  <!-- ============ MAIN CONTENT ============ -->
  <main id="main-content">

    <!-- PAGE: Home -->
    <section class="page active" id="page-home">
      <!-- Banner Carousel -->
      <div class="banner-carousel">
        <div class="banner-track" id="banner-track">
          <!-- Populated by JS renderBannerCarousel() -->
        </div>
        <button class="banner-arrow banner-arrow-left" id="banner-prev">‹</button>
        <button class="banner-arrow banner-arrow-right" id="banner-next">›</button>
        <div class="banner-dots" id="banner-dots"></div>
      </div>

      <!-- System Announcement -->
      <div class="announce-card" id="announce-card">
        <div class="announce-header">
          <span>系統公告</span>
        </div>
        <div class="announce-body" id="announce-body"></div>
      </div>

      <!-- Hot Events -->
      <div class="section-title">近期活動</div>
      <div class="horizontal-scroll" id="hot-events">
        <!-- Populated by JS -->
      </div>

      <!-- Ongoing Tournaments -->
      <div class="section-title">進行中賽事</div>
      <div class="horizontal-scroll" id="ongoing-tournaments">
        <!-- Populated by JS -->
      </div>

      <!-- Sponsors -->
      <hr style="border:none;border-top:1px solid var(--border);margin:1rem 0 .5rem">
      <div class="sponsor-grid" id="sponsor-grid">
        <!-- 6col × 4row = 24 slots, JS 渲染 -->
      </div>

      <!-- Floating Ads (Populated by JS) -->
      <div class="floating-ads" id="floating-ads"></div>
    </section>

    <!-- PAGE: Activities -->
    <section class="page" id="page-activities">
      <div class="page-header">
        <h2>活動行事曆</h2>
        <button class="filter-btn" id="filter-toggle">篩選 ▾</button>
      </div>
      <div class="filter-bar" id="filter-bar">
        <select id="activity-filter-type">
          <option value="">全部類別</option>
          <option value="friendly">友誼</option>
          <option value="camp">教學</option>
          <option value="play">PLAY</option>
          <option value="watch">觀賽</option>
        </select>
        <div class="filter-search-wrap">
          <input type="text" id="activity-filter-keyword" placeholder="搜尋名稱 / 地點..." style="border-radius:var(--radius-sm) 0 0 var(--radius-sm);border-right:none">
          <button id="activity-filter-search-btn" class="filter-search-btn">搜尋</button>
        </div>
      </div>
      <!-- Coach+ : My Activity Management -->
      <div class="my-section" data-min-role="coach">
        <button class="action-btn" onclick="App.showPage('page-my-activities')">我的活動管理</button>
      </div>
      <div class="timeline-calendar" id="activity-list">
        <!-- Populated by JS -->
      </div>
    </section>

    <!-- PAGE: Activity Detail -->
    <section class="page" id="page-activity-detail">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2 id="detail-title">活動名稱</h2>
      </div>
      <div class="td-img-placeholder" id="detail-img-placeholder">活動圖片 800 × 300</div>
      <div class="detail-body" id="detail-body">
        <!-- Populated by JS -->
      </div>
    </section>

    <!-- PAGE: Teams -->
    <section class="page" id="page-teams">
      <div class="page-header">
        <h2>球隊</h2>
      </div>
      <div class="team-search-bar">
        <input type="text" id="team-search" placeholder="搜尋球隊名稱..." oninput="App.filterTeams()">
        <select id="team-region-filter" onchange="App.filterTeams()">
          <option value="">全部地區</option>
          <option value="台北市">台北市</option>
          <option value="新北市">新北市</option>
          <option value="桃園市">桃園市</option>
          <option value="台中市">台中市</option>
          <option value="高雄市">高雄市</option>
        </select>
      </div>
      <div class="my-section" data-min-role="captain">
        <button class="action-btn" onclick="App.showPage('page-team-manage')">球隊管理</button>
      </div>
      <div class="team-grid" id="team-list">
        <!-- Populated by JS -->
      </div>
    </section>

    <!-- PAGE: Team Detail -->
    <section class="page" id="page-team-detail">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2 id="team-detail-title">球隊名稱</h2>
        <span class="team-detail-name-en" id="team-detail-name-en"></span>
      </div>
      <div class="td-img-placeholder" id="team-detail-img">球隊封面 800 × 300</div>
      <div class="detail-body" id="team-detail-body"></div>
    </section>

    <!-- PAGE: Team Manage (Captain+) -->
    <section class="page" id="page-team-manage" data-min-role="captain">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>球隊管理</h2>
        <button class="primary-btn small" onclick="App.showTeamForm()">＋ 新增球隊</button>
      </div>
      <div class="tab-bar" id="team-manage-tabs">
        <button class="tab active" data-tab="my-teams">我的球隊</button>
        <button class="tab" data-tab="all-teams">所有球隊</button>
      </div>
      <div class="card-list" id="team-manage-list"></div>
    </section>

    <!-- PAGE: Messages -->
    <section class="page" id="page-messages">
      <div class="page-header">
        <h2>訊息</h2>
      </div>
      <div style="display:flex;align-items:center;gap:.4rem;padding:0 .5rem .4rem;flex-wrap:wrap">
        <button class="primary-btn small" style="font-size:.75rem;padding:.28rem .6rem" onclick="App.markAllRead()">一鍵全讀</button>
        <button style="font-size:.75rem;padding:.28rem .6rem;border:none;border-radius:var(--radius-sm);background:#ef4444;color:#fff;cursor:pointer;font-weight:600" onclick="App.clearAllMessages()">清空訊息</button>
        <span id="storage-bar" style="font-size:.75rem;padding:.28rem .6rem;border-radius:var(--radius-sm);background:#fff;border:1px solid var(--border);color:#3b82f6;font-weight:600">剩餘容量：<strong style="color:#111">50</strong>/50</span>
      </div>
      <div class="tab-bar" id="msg-inbox-tabs">
        <button class="tab active" data-msgtype="all">全部</button>
        <button class="tab" data-msgtype="system">系統</button>
        <button class="tab" data-msgtype="activity">活動</button>
        <button class="tab" data-msgtype="trade">交易</button>
        <button class="tab" data-msgtype="private">私訊</button>
      </div>
      <div class="card-list" id="message-list">
        <!-- Populated by JS -->
      </div>
    </section>

    <!-- PAGE: Profile (My) -->
    <section class="page" id="page-profile">
      <!-- 未登入提示（正式版用） -->
      <div id="profile-login-prompt" class="profile-login-prompt" style="display:none">
        <div class="login-prompt-content">
          <div class="login-prompt-icon">👤</div>
          <h3>尚未登入</h3>
          <p>請先使用 LINE 帳號登入以查看個人資料</p>
          <button class="line-login-btn large" onclick="LineAuth.login()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="#fff"><path d="M12 2C6.48 2 2 5.83 2 10.5c0 4.18 3.66 7.68 8.58 8.38.33.07.78.22.9.5.1.26.07.66.03.92l-.15.86c-.04.26-.2 1.01.88.55s5.88-3.47 8.03-5.93C22.08 13.79 22 12.18 22 10.5 22 5.83 17.52 2 12 2z"/></svg>
            LINE 登入
          </button>
        </div>
      </div>
      <!-- Profile 主內容 -->
      <div id="profile-content">
        <div class="profile-header">
          <div class="profile-avatar" id="profile-avatar"></div>
          <div class="profile-title" id="profile-title">-</div>
          <div id="profile-uid-wrap" style="margin-top:.25rem;display:flex;align-items:center;justify-content:center;gap:.3rem"></div>
          <div id="profile-role-tag-wrap" style="margin-top:.3rem"></div>
          <div class="profile-level" id="profile-level">
            <span id="profile-lv">Lv.1</span>
            <div class="exp-bar"><div class="exp-fill" id="profile-exp-fill" style="width:0%"></div></div>
            <span class="exp-text" id="profile-exp-text">0 / 400</span>
          </div>
        </div>
        <div class="profile-stats">
          <div class="stat-item"><span class="stat-num" id="profile-stat-total">0</span><span class="stat-label">參加場次</span></div>
          <div class="stat-item"><span class="stat-num" id="profile-stat-done">0</span><span class="stat-label">完成</span></div>
          <div class="stat-item"><span class="stat-num" id="profile-stat-rate">0%</span><span class="stat-label">出席率</span></div>
          <div class="stat-item"><span class="stat-num" id="profile-stat-badges">0</span><span class="stat-label">徽章</span></div>
        </div>
        <div class="quick-grid">
          <button class="quick-item" onclick="App.showPage('page-achievements')"><span>🏅</span>徽章/成就</button>
          <button class="quick-item" onclick="App.showPage('page-titles')"><span>🎖️</span>稱號</button>
          <button class="quick-item disabled" disabled><span>👤</span>紙娃娃</button>
        </div>
        <!-- 社群連結按鈕列 -->
        <div class="social-grid" id="social-grid">
          <button class="social-btn" data-platform="fb" onclick="App.openSocialLinkModal('fb')" title="Facebook">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
          </button>
          <button class="social-btn" data-platform="ig" onclick="App.openSocialLinkModal('ig')" title="Instagram">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>
          </button>
          <button class="social-btn" data-platform="threads" onclick="App.openSocialLinkModal('threads')" title="Threads">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M12.186 24h-.007c-3.581-.024-6.334-1.205-8.184-3.509C2.35 18.44 1.5 15.586 1.472 12.01v-.017c.03-3.579.879-6.43 2.525-8.482C5.845 1.205 8.6.024 12.18 0h.014c2.746.02 5.043.725 6.826 2.098 1.677 1.29 2.858 3.13 3.509 5.467l-2.04.569c-1.104-3.96-3.898-5.984-8.304-6.015-2.91.022-5.11.936-6.54 2.717C4.307 6.504 3.616 8.914 3.59 12c.025 3.086.718 5.496 2.057 7.164 1.432 1.781 3.632 2.695 6.54 2.717 2.227-.017 4.074-.517 5.49-1.482 1.2-.82 2.12-2.012 2.7-3.508l1.942.672a10.987 10.987 0 01-3.335 4.397C17.165 23.275 14.898 23.98 12.186 24zm4.394-8.858c-.095-1.17-.584-2.098-1.422-2.698-.7-.5-1.6-.775-2.617-.8-.87.02-1.653.26-2.262.687-.66.47-1.065 1.12-1.138 1.822-.078.78.225 1.41.85 1.776.54.313 1.19.48 1.92.49.95-.01 1.82-.32 2.42-.86.44-.39.7-.86.77-1.38.03-.16.04-.32.04-.48v-.01c-.005-.185-.02-.365-.046-.537l-.015-.01zm1.87-1.06c.068.36.113.73.134 1.11.03.52.003 1.04-.084 1.55-.242 1.39-.98 2.56-2.14 3.38-1.15.82-2.54 1.257-4.02 1.267h-.05c-1.12-.01-2.1-.275-2.913-.786-1.125-.706-1.68-1.844-1.54-3.15.12-1.13.747-2.097 1.76-2.72.88-.54 1.96-.837 3.12-.86h.06c.68.01 1.33.11 1.93.29-.16-.6-.48-1.07-.96-1.4-.58-.4-1.32-.61-2.16-.61h-.04c-.96.01-1.79.24-2.46.67l-.96-1.72c.97-.61 2.15-.95 3.44-.97h.06c1.34.02 2.5.4 3.39 1.1.78.62 1.3 1.45 1.55 2.44l.04.17z"/></svg>
          </button>
          <button class="social-btn" data-platform="yt" onclick="App.openSocialLinkModal('yt')" title="YouTube">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 00-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 00.502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 002.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 002.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
          </button>
          <button class="social-btn" data-platform="twitter" onclick="App.openSocialLinkModal('twitter')" title="X (Twitter)">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
          </button>
        </div>
        <div class="info-card" id="profile-info-card">
          <div class="info-title" style="display:flex;justify-content:space-between;align-items:center">
            <span>我的資料</span>
            <button class="outline-btn" style="font-size:.7rem;padding:.2rem .5rem" id="profile-edit-btn" onclick="App.toggleProfileEdit()">編輯</button>
          </div>
          <!-- 顯示模式 -->
          <div id="profile-info-display">
            <div class="info-row"><span>性別</span><span id="profile-gender">-</span></div>
            <div class="info-row"><span>生日</span><span id="profile-birthday">-</span></div>
            <div class="info-row"><span>地區</span><span id="profile-region">-</span></div>
            <div class="info-row"><span>運動類別</span><span id="profile-sports">-</span></div>
            <div class="info-row"><span>所屬球隊</span><span id="profile-team">-</span></div>
            <div class="info-row"><span>聯繫方式</span><span id="profile-phone">-</span></div>
          </div>
          <!-- 編輯模式 -->
          <div id="profile-info-edit" style="display:none">
            <div class="info-row"><span>性別</span><span id="profile-gender-display">-</span></div>
            <div class="info-row"><span>生日</span><input type="date" id="profile-edit-birthday" class="profile-edit-input"></div>
            <div class="info-row"><span>地區</span><input type="text" id="profile-edit-region" class="profile-edit-input" placeholder="例：台北市"></div>
            <div class="info-row"><span>運動類別</span><span id="profile-sports-display">-</span></div>
            <div class="info-row"><span>所屬球隊</span><span id="profile-team-display">-</span></div>
            <div class="info-row"><span>聯繫方式</span><input type="tel" id="profile-edit-phone" class="profile-edit-input" placeholder="例：0912-345-678"></div>
            <div style="display:flex;gap:.5rem;margin-top:.5rem;justify-content:flex-end">
              <button class="outline-btn" style="font-size:.75rem;padding:.3rem .8rem" onclick="App.toggleProfileEdit()">取消</button>
              <button class="primary-btn small" onclick="App.saveProfileInfo()">儲存</button>
            </div>
          </div>
        </div>
        <div class="info-card">
          <div class="info-title">報名紀錄</div>
          <div class="tab-bar compact" id="record-tabs">
            <button class="tab active" data-filter="all">全部</button>
            <button class="tab" data-filter="completed">完成</button>
            <button class="tab" data-filter="cancelled">取消</button>
            <button class="tab" data-filter="early-left">早退</button>
          </div>
          <div class="mini-activity-list" id="my-activity-records"></div>
        </div>
      </div>
    </section>

    <!-- PAGE: QR Code -->
    <section class="page" id="page-qrcode">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>我的 QR Code</h2>
      </div>
      <div class="center-content">
        <div class="qr-placeholder">
          <div class="qr-box" id="page-qr-canvas">QR<br>CODE</div>
          <p class="uid-text" id="page-qr-uid">UID: —</p>
          <p class="qr-hint">掃碼查看個人資料卡片</p>
        </div>
      </div>
    </section>

    <!-- PAGE: Paper Doll -->
    <section class="page" id="page-paperdoll">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>紙娃娃編輯</h2>
        <button class="text-btn">儲存</button>
      </div>
      <div class="paperdoll-preview">
        <div class="doll-canvas" id="doll-canvas">
          <div class="doll-layer bg">背景</div>
          <div class="doll-layer silhouette">人形</div>
          <div class="doll-layer shoes">鞋</div>
          <div class="doll-layer pants">褲</div>
          <div class="doll-layer body">衣</div>
          <div class="doll-layer head">頭</div>
          <div class="doll-layer pet">寵物</div>
          <div class="doll-layer accessory">配件</div>
        </div>
      </div>
      <div class="tab-bar compact">
        <button class="tab active">頭部</button>
        <button class="tab">球衣</button>
        <button class="tab">球褲</button>
        <button class="tab">鞋子</button>
        <button class="tab">寵物</button>
        <button class="tab">背景</button>
        <button class="tab">配件</button>
      </div>
      <div class="doll-items">
        <div class="doll-item selected">球</div>
        <div class="doll-item">帽</div>
        <div class="doll-item">冠</div>
        <div class="doll-item locked">鎖</div>
        <div class="doll-item locked">鎖</div>
      </div>
      <div class="doll-actions">
        <button class="outline-btn">移除此部位</button>
        <button class="primary-btn">穿戴選中</button>
      </div>
    </section>

    <!-- PAGE: Achievements -->
    <section class="page" id="page-achievements">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>成就系統</h2>
      </div>
      <div class="achievement-grid" id="achievement-grid"></div>
    </section>

    <!-- PAGE: Badges -->
    <section class="page" id="page-badges">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>徽章收藏</h2>
      </div>
      <div class="badge-grid" id="badge-grid"></div>
    </section>

    <!-- PAGE: Titles -->
    <section class="page" id="page-titles">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>稱號設定</h2>
      </div>
      <div class="title-config">
        <div class="title-preview" id="title-preview">-</div>
        <div class="title-row">
          <label>大成就稱號</label>
          <select id="title-big"><option value="">（無）</option></select>
        </div>
        <div class="title-row">
          <label>普通稱號</label>
          <select id="title-normal"><option value="">（無）</option></select>
        </div>
        <div class="title-row">
          <label>LINE 暱稱</label>
          <input type="text" id="title-line-name" value="" disabled>
        </div>
        <button class="primary-btn full-width" onclick="App.saveTitles()">儲存稱號</button>
      </div>
    </section>

    <!-- PAGE: Scan QR -->
    <section class="page" id="page-scan" data-min-role="coach">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>掃碼簽到 / 簽退</h2>
      </div>
      <div class="scan-content">
        <select id="scan-event-select" class="scan-event-select">
          <option value="">— 請選擇活動 —</option>
        </select>
        <div class="scan-mode-toggle">
          <button class="scan-mode active" data-mode="checkin">簽到</button>
          <button class="scan-mode" data-mode="checkout">簽退</button>
        </div>
        <div class="scan-camera">
          <div class="scan-qr-reader" id="scan-qr-reader">
            <span style="color:var(--text-muted);font-size:.85rem;">點擊下方按鈕開啟相機</span>
          </div>
          <button class="scan-camera-btn" id="scan-camera-btn" disabled>開啟相機掃碼</button>
        </div>
        <div class="scan-manual">
          <span>或手動輸入 UID：</span>
          <div class="scan-input-row">
            <input type="text" id="scan-uid-input" placeholder="U1a2b3c..." disabled>
            <button class="primary-btn" id="scan-manual-btn" disabled>確認</button>
          </div>
        </div>
        <div class="scan-results" id="scan-results"></div>
        <div class="scan-stats" id="scan-stats"></div>
        <div id="scan-checkin-section"></div>
        <div id="scan-checkout-section"></div>
        <div id="scan-unreg-section"></div>
      </div>
    </section>

    <!-- Scan choice modal -->
    <div class="scan-choice-overlay" id="scan-choice-modal">
      <div class="scan-choice-box">
        <h3 id="scan-choice-name"></h3>
        <p id="scan-choice-uid"></p>
        <div class="scan-choice-btns">
          <button class="scan-choice-checkin-btn" id="scan-choice-checkin">簽到</button>
          <button class="scan-choice-checkout-btn" id="scan-choice-checkout">簽退</button>
          <button class="scan-choice-cancel-btn" id="scan-choice-cancel">取消</button>
        </div>
      </div>
    </div>

    <!-- PAGE: Tournament Center (bottom tab) -->
    <section class="page" id="page-tournaments">
      <div class="page-header">
        <h2>賽事中心</h2>
      </div>
      <div id="tournament-timeline"></div>
    </section>

    <!-- PAGE: Tournament Detail -->
    <section class="page" id="page-tournament-detail">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2 id="td-title">賽事名稱</h2>
        <button class="text-btn" onclick="App.toggleModal('rules-modal')">規則</button>
      </div>
      <div class="td-img-placeholder" id="td-img-placeholder">賽事圖片 800 × 300</div>
      <div class="tab-bar" id="td-tabs">
        <button class="tab active" data-ttab="schedule">賽程</button>
        <button class="tab" data-ttab="standings">排名</button>
        <button class="tab" data-ttab="trades">交易</button>
      </div>
      <div class="tournament-content" id="tournament-content"></div>
    </section>

    <!-- PAGE: Second Hand Shop -->
    <section class="page" id="page-shop">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>二手商品區</h2>
      </div>
      <div class="filter-bar visible">
        <select><option>全部分類</option><option>球鞋</option><option>球衣</option><option>護具</option></select>
        <select><option>全部價格</option><option>$0~500</option><option>$500~1500</option><option>$1500+</option></select>
        <select><option>最新上架</option><option>最舊上架</option></select>
      </div>
      <div class="shop-grid" id="shop-grid"></div>
    </section>

    <!-- PAGE: Shop Detail -->
    <section class="page" id="page-shop-detail">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2 id="shop-detail-title">商品名稱</h2>
      </div>
      <div class="detail-body" id="shop-detail-body"></div>
    </section>

    <!-- PAGE: Leaderboard -->
    <section class="page" id="page-leaderboard">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>排行榜</h2>
      </div>
      <div class="tab-bar compact">
        <button class="tab active">週</button>
        <button class="tab">雙週</button>
        <button class="tab">月</button>
        <button class="tab">季</button>
        <button class="tab">年</button>
      </div>
      <div class="leaderboard-list" id="leaderboard-list"></div>
    </section>

    <!-- PAGE: User Card (Scan result) -->
    <section class="page" id="page-user-card">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>用戶資料卡片</h2>
      </div>
      <div class="user-card-full" id="user-card-full"></div>
    </section>

    <!-- ========== BACKEND PAGES ========== -->

    <!-- PAGE: My Activities (Coach+) -->
    <section class="page" id="page-my-activities" data-min-role="coach">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>我的活動管理</h2>
        <button class="primary-btn small" onclick="App.openCreateEventModal()">＋ 新增</button>
      </div>
      <div id="my-activity-stats" style="font-size:.75rem;color:var(--text-muted);padding:0 .5rem .3rem;text-align:right"></div>
      <div class="tab-bar" id="my-activity-tabs">
        <button class="tab active" data-afilter="all">全部</button>
        <button class="tab" data-afilter="open">報名中</button>
        <button class="tab" data-afilter="full">已額滿</button>
        <button class="tab" data-afilter="ended">已結束</button>
        <button class="tab" data-afilter="cancelled">已取消</button>
      </div>
      <div class="card-list" id="my-activity-list"></div>
      <!-- 查看名單彈窗 -->
      <div id="my-activity-detail-modal" style="display:none;position:fixed;inset:0;z-index:1200;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);align-items:center;justify-content:center" onclick="if(event.target===this)this.style.display='none'">
        <div style="background:var(--bg-card);border-radius:var(--radius-lg);max-width:440px;width:92%;max-height:85vh;overflow-y:auto;padding:1.2rem;position:relative">
          <button style="position:absolute;top:.6rem;right:.8rem;background:none;border:none;font-size:1.2rem;cursor:pointer;color:var(--text-muted)" onclick="document.getElementById('my-activity-detail-modal').style.display='none'">✕</button>
          <div id="my-activity-detail-content"></div>
        </div>
      </div>
    </section>

    <!-- PAGE: Backend - User Management (Admin+) -->
    <section class="page" id="page-admin-users" data-min-role="admin">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>用戶管理</h2>
      </div>
      <div class="admin-search">
        <input type="text" id="admin-user-search" placeholder="搜尋 UID 或暱稱..." oninput="App.filterAdminUsers()">
        <div class="admin-filters">
          <select id="admin-user-role-filter" onchange="App.filterAdminUsers()"><option value="">全部身份</option><option value="user">一般用戶</option><option value="coach">教練</option><option value="captain">領隊</option><option value="venue_owner">場主</option></select>
          <select id="admin-user-region-filter" onchange="App.filterAdminUsers()"><option value="">全部地區</option><option value="台北">台北</option><option value="新北">新北</option><option value="桃園">桃園</option><option value="台中">台中</option><option value="高雄">高雄</option></select>
        </div>
      </div>
      <div class="admin-card-list" id="admin-user-list"></div>
    </section>

    <!-- PAGE: Backend - EXP Management (Super Admin) -->
    <section class="page" id="page-admin-exp" data-min-role="super_admin">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>手動 EXP 管理</h2>
      </div>
      <div class="admin-search">
        <input type="text" placeholder="搜尋 UID 或暱稱..." id="exp-search">
        <button class="primary-btn" onclick="App.demoExpSearch()">搜尋</button>
      </div>
      <div class="exp-target-card" id="exp-target-card">
        <div class="exp-target-info">
          <div class="profile-avatar small">A</div>
          <div>
            <div class="exp-target-name">暱稱A</div>
            <div class="exp-target-detail">UID: Uxxxxxx ・ Lv.25 ・ EXP: 2350</div>
          </div>
        </div>
        <div class="exp-form">
          <div class="form-row">
            <label>EXP 調整</label>
            <input type="number" placeholder="+500 或 -100" value="500">
          </div>
          <div class="form-row">
            <label>備註原因 <span class="required">*必填</span></label>
            <input type="text" placeholder="例：活動獎勵">
          </div>
          <button class="primary-btn full-width" onclick="App.handleExpSubmit()">確認送出</button>
        </div>
      </div>
      <div class="info-card">
        <div class="info-title">最近操作紀錄</div>
        <div class="log-list" id="exp-log-list"></div>
      </div>
    </section>

    <!-- PAGE: Backend - Ad Management (Admin+) -->
    <section class="page" id="page-admin-banners" data-min-role="admin">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>廣告管理</h2>
      </div>
      <!-- Banner 廣告 -->
      <div class="ad-collapse-section">
        <div class="admin-section-label ad-collapse-toggle" onclick="App.toggleAdSection(this)">
          <span>Banner 廣告（3 個廣告位）</span><span class="ad-collapse-arrow">▶</span>
        </div>
        <div class="ad-collapse-content" style="display:none">
          <div class="card-list" id="banner-manage-list"></div>
          <div class="form-card" id="banner-form-card" style="display:none">
            <div class="role-editor-header"><span id="banner-form-title">編輯 Banner</span><button class="text-btn" onclick="App.hideBannerForm()">取消</button></div>
            <div class="form-row"><label>廣告位名稱</label><input type="text" id="banner-slot-display" placeholder="例：廣告位 1" maxlength="12"></div>
            <div class="form-row">
              <label>廣告圖片</label>
              <div class="ce-upload">
                <input type="file" id="banner-image" accept=".jpg,.jpeg,.png" hidden>
                <div class="ce-upload-placeholder" id="banner-preview" onclick="document.getElementById('banner-image').click()">
                  <span class="ce-upload-icon">+</span>
                  <span class="ce-upload-text">點擊上傳圖片</span>
                  <span class="ce-upload-hint">建議尺寸 1200 × 400 px｜JPG / PNG｜最大 2MB</span>
                </div>
              </div>
            </div>
            <div class="form-row"><label>標題</label><input type="text" id="banner-input-title" placeholder="例：春季聯賽 Banner" maxlength="12"></div>
            <div class="form-row"><label>跳轉連結（選填）</label><input type="text" id="banner-input-link" placeholder="https://..."></div>
            <div class="form-row"><label>啟用方式</label><select id="banner-input-mode" onchange="App.toggleBannerSchedule()"><option value="now">立即啟用</option><option value="scheduled">預約啟用</option></select></div>
            <div class="form-row" id="banner-publish-row" style="display:none"><label>啟用時間</label><input type="datetime-local" id="banner-input-publish"></div>
            <div class="form-row"><label>結束時間</label><input type="datetime-local" id="banner-input-unpublish"></div>
            <button class="primary-btn full-width" onclick="App.saveBanner()">儲存</button>
          </div>
        </div>
      </div>

      <!-- 浮動廣告 -->
      <div class="ad-collapse-section">
        <div class="admin-section-label ad-collapse-toggle" onclick="App.toggleAdSection(this)">
          <span>浮動廣告（AD1 / AD2）</span><span class="ad-collapse-arrow">▶</span>
        </div>
        <div class="ad-collapse-content" style="display:none">
          <div id="floating-ad-manage-list"></div>
          <div class="form-card" id="floatad-form-card" style="display:none">
            <div class="role-editor-header"><span id="floatad-form-title">編輯浮動廣告</span><button class="text-btn" onclick="App.hideFloatingAdForm()">取消</button></div>
            <div class="form-row">
              <label>廣告圖片</label>
              <div class="ce-upload">
                <input type="file" id="floatad-image" accept=".jpg,.jpeg,.png" hidden>
                <div class="ce-upload-placeholder" id="floatad-preview" onclick="document.getElementById('floatad-image').click()">
                  <span class="ce-upload-icon">+</span>
                  <span class="ce-upload-text">點擊上傳圖片</span>
                  <span class="ce-upload-hint">建議尺寸 200 × 200 px｜JPG / PNG｜最大 2MB</span>
                </div>
              </div>
            </div>
            <div class="form-row"><label>廣告標題</label><input type="text" id="floatad-input-title" placeholder="例：球鞋促銷" maxlength="12"></div>
            <div class="form-row"><label>跳轉連結（選填）</label><input type="text" id="floatad-input-link" placeholder="https://..."></div>
            <div class="form-row"><label>啟用方式</label><select id="floatad-input-mode" onchange="App.toggleFloatAdSchedule()"><option value="now">立即啟用</option><option value="scheduled">預約啟用</option></select></div>
            <div class="form-row" id="floatad-publish-row" style="display:none"><label>啟用時間</label><input type="datetime-local" id="floatad-input-publish"></div>
            <div class="form-row"><label>結束時間</label><input type="datetime-local" id="floatad-input-unpublish"></div>
            <button class="primary-btn full-width" onclick="App.saveFloatingAd()">儲存</button>
          </div>
        </div>
      </div>

      <!-- 彈跳廣告 -->
      <div class="ad-collapse-section">
        <div class="admin-section-label ad-collapse-toggle" onclick="App.toggleAdSection(this)">
          <span>彈跳廣告（3 個廣告位）</span><span class="ad-collapse-arrow">▶</span>
        </div>
        <div class="ad-collapse-content" style="display:none">
          <div id="popup-ad-manage-list"></div>
          <div class="form-card" id="popupad-form-card" style="display:none">
            <div class="role-editor-header"><span id="popupad-form-title">編輯彈跳廣告</span><button class="text-btn" onclick="App.hidePopupAdForm()">取消</button></div>
            <div class="form-row"><label>廣告位</label><span id="popupad-layer-display" style="font-weight:600"></span></div>
            <div class="form-row">
              <label>廣告圖片</label>
              <div class="ce-upload">
                <input type="file" id="popupad-image" accept=".jpg,.jpeg,.png" hidden>
                <div class="ce-upload-placeholder" id="popupad-preview" onclick="document.getElementById('popupad-image').click()">
                  <span class="ce-upload-icon">+</span>
                  <span class="ce-upload-text">點擊上傳圖片</span>
                  <span class="ce-upload-hint">建議尺寸 600 × 800 px｜JPG / PNG｜最大 2MB</span>
                </div>
              </div>
            </div>
            <div class="form-row"><label>廣告標題</label><input type="text" id="popupad-input-title" placeholder="例：春季聯賽宣傳" maxlength="12"></div>
            <div class="form-row"><label>連結網址（選填）</label><input type="text" id="popupad-input-link" placeholder="https://..."></div>
            <div class="form-row"><label>啟用方式</label><select id="popupad-input-mode" onchange="App.togglePopupAdSchedule()"><option value="now">立即啟用</option><option value="scheduled">預約啟用</option></select></div>
            <div class="form-row" id="popupad-publish-row" style="display:none"><label>啟用時間</label><input type="datetime-local" id="popupad-input-publish"></div>
            <div class="form-row"><label>結束時間</label><input type="datetime-local" id="popupad-input-unpublish"></div>
            <button class="primary-btn full-width" onclick="App.savePopupAd()">儲存</button>
          </div>
        </div>
      </div>

      <!-- 贊助商 -->
      <div class="ad-collapse-section">
        <div class="admin-section-label ad-collapse-toggle" onclick="App.toggleAdSection(this)">
          <span>贊助商（6 個欄位）</span><span class="ad-collapse-arrow">▶</span>
        </div>
        <div class="ad-collapse-content" style="display:none">
          <div id="sponsor-manage-list"></div>
        </div>
      </div>
    </section>

    <!-- PAGE: Backend - Shop Management (Admin+) -->
    <section class="page" id="page-admin-shop" data-min-role="admin">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>二手商品管理</h2>
        <button class="primary-btn small" onclick="App.showShopForm()">＋ 新增</button>
      </div>
      <div class="admin-search">
        <input type="text" placeholder="搜尋商品...">
      </div>
      <div class="card-list" id="shop-manage-list"></div>
    </section>

    <!-- PAGE: Backend - Team Management (Admin+) -->
    <section class="page" id="page-admin-teams" data-min-role="admin">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>球隊管理</h2>
        <button class="primary-btn small" onclick="App.showTeamForm()">＋ 新增球隊</button>
      </div>
      <div class="admin-search">
        <input type="text" id="team-search-input" placeholder="搜尋球隊名稱 / 領隊..." oninput="App.filterAdminTeams()">
      </div>
      <div class="card-list" id="admin-team-list"></div>
    </section>

    <!-- PAGE: Backend - Message Management (Admin+) -->
    <section class="page" id="page-admin-messages" data-min-role="admin">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>站內信管理</h2>
        <button class="primary-btn small" onclick="App.showMsgCompose()">＋ 發送</button>
      </div>
      <div id="msg-sent-count" style="text-align:right;font-size:.75rem;color:var(--text-muted);padding:0 .5rem .3rem"></div>
      <div class="tab-bar" id="msg-manage-tabs">
        <button class="tab active" data-mfilter="sent">已發送</button>
        <button class="tab" data-mfilter="scheduled">已排程</button>
        <button class="tab" data-mfilter="recalled">已回收</button>
        <button class="tab" data-mfilter="deleted">已刪除</button>
      </div>
      <div class="card-list" id="msg-manage-list"></div>
      <!-- 站內信詳情彈窗 -->
      <div id="msg-detail-modal" style="display:none;position:fixed;inset:0;z-index:1200;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);align-items:center;justify-content:center">
        <div style="background:var(--bg-card);border-radius:var(--radius-lg);max-width:420px;width:90%;max-height:80vh;overflow-y:auto;padding:1.2rem;position:relative">
          <button style="position:absolute;top:.6rem;right:.8rem;background:none;border:none;font-size:1.2rem;cursor:pointer;color:var(--text-muted)" onclick="document.getElementById('msg-detail-modal').style.display='none'">✕</button>
          <div id="msg-detail-content"></div>
        </div>
      </div>
      <!-- 撰寫站內信（疊窗） -->
      <div id="msg-compose" style="display:none;position:fixed;inset:0;z-index:1200;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);align-items:center;justify-content:center" onclick="if(event.target===this)App.hideMsgCompose()">
        <div style="background:var(--bg-card);border-radius:var(--radius-lg);max-width:440px;width:92%;max-height:85vh;overflow-y:auto;padding:1.2rem;position:relative">
          <div class="role-editor-header" style="margin-bottom:.6rem"><span id="msg-compose-title" style="font-size:.95rem;font-weight:700">撰寫站內信</span><button style="background:none;border:none;font-size:1.2rem;cursor:pointer;color:var(--text-muted)" onclick="App.hideMsgCompose()">✕</button></div>
          <div class="form-row">
            <label>信件類別</label>
            <select id="msg-category">
              <option value="system">系統</option>
              <option value="activity">活動</option>
              <option value="trade">交易</option>
              <option value="private">私訊</option>
            </select>
          </div>
          <div class="form-row"><label>標題（上限 12 字）</label><input type="text" id="msg-title" placeholder="信件標題" maxlength="12"></div>
          <div class="form-row">
            <label>發送方式</label>
            <select id="msg-target" onchange="App.onMsgTargetChange()">
              <option value="all">全體用戶</option>
              <option value="coach_up">教練以上</option>
              <option value="admin">管理員</option>
              <option value="team">指定球隊</option>
              <option value="individual">指定用戶 (UID/暱稱)</option>
            </select>
          </div>
          <div class="form-row" id="msg-individual-row" style="display:none">
            <label>對象 UID 或暱稱</label>
            <input type="text" id="msg-individual-target" placeholder="輸入 UID 或暱稱搜尋" oninput="App.searchMsgTarget()">
            <div id="msg-target-result" style="font-size:.75rem;margin-top:.2rem;color:var(--text-muted)"></div>
          </div>
          <div class="form-row"><label>內容（上限 300 字）</label><textarea id="msg-body" rows="4" placeholder="信件內容..." maxlength="300"></textarea></div>
          <div class="form-row">
            <label>排程發送（留空＝立即發送）</label>
            <input type="datetime-local" id="msg-schedule">
          </div>
          <button class="primary-btn full-width" onclick="App.sendMessage()">發送</button>
        </div>
      </div>
    </section>

    <!-- PAGE: Backend - Tournament Management (Admin+) -->
    <section class="page" id="page-admin-tournaments" data-min-role="admin">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>賽事管理</h2>
        <button class="primary-btn small" onclick="App.showModal('create-tournament-modal')">＋ 新增</button>
      </div>
      <div class="card-list" id="tournament-manage-list"></div>
    </section>

    <!-- PAGE: Backend - Achievement Management (Super Admin) -->
    <section class="page" id="page-admin-achievements" data-min-role="super_admin">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>成就 / 徽章管理</h2>
      </div>
      <div class="tab-bar" id="admin-ach-tabs">
        <button class="tab active" data-atype="achievements">成就</button>
        <button class="tab" data-atype="badges">徽章</button>
      </div>
      <div id="admin-ach-list"></div>
      <button class="primary-btn full-width" style="margin-top:.5rem" onclick="App._adminAchTab==='achievements'?App.showAchForm():App.showBadgeForm()">＋ 新增</button>

      <!-- Achievement Create/Edit Form -->
      <div class="form-card" id="ach-form-card" style="display:none;margin-top:.5rem">
        <div class="role-editor-header">
          <span id="ach-form-title">新增成就</span>
          <button class="text-btn" onclick="App.hideAchForm()">取消</button>
        </div>
        <div class="form-row"><label>成就名稱</label><input type="text" id="ach-input-name" placeholder="例：百場達人"></div>
        <div class="form-row"><label>描述（目標條件）</label><input type="text" id="ach-input-desc" placeholder="例：累計參加 100 場活動"></div>
        <div class="form-row"><label>目標次數</label><input type="number" id="ach-input-target" value="10" min="1"></div>
        <div class="form-row">
          <label>類別（框線顏色）</label>
          <select id="ach-input-category">
            <option value="bronze">銅</option>
            <option value="silver">銀</option>
            <option value="gold">金</option>
          </select>
        </div>
        <div style="font-size:.72rem;color:var(--text-muted);margin-bottom:.5rem">建立成就時會自動建立關聯徽章；修改目標次數後，未達新目標的用戶將變回未完成</div>
        <button class="primary-btn full-width" onclick="App.saveAchievement()">儲存</button>
      </div>

      <!-- Badge Create/Edit Form -->
      <div class="form-card" id="badge-form-card" style="display:none;margin-top:.5rem">
        <div class="role-editor-header">
          <span id="badge-form-title">新增徽章</span>
          <button class="text-btn" onclick="App.hideBadgeForm()">取消</button>
        </div>
        <div class="form-row"><label>徽章名稱</label><input type="text" id="badge-input-name" placeholder="例：冠軍徽章"></div>
        <div class="form-row">
          <label>類別（框線顏色）</label>
          <select id="badge-input-category">
            <option value="bronze">銅</option>
            <option value="silver">銀</option>
            <option value="gold">金</option>
          </select>
        </div>
        <div class="form-row">
          <label>關聯成就</label>
          <select id="badge-input-ach"><option value="">（不關聯成就）</option></select>
        </div>
        <div style="font-size:.72rem;color:var(--text-muted);margin-bottom:.5rem">徽章圖片將來可從此處上傳（目前顯示為預留框）</div>
        <button class="primary-btn full-width" onclick="App.saveBadge()">儲存</button>
      </div>
    </section>

    <!-- PAGE: Backend - Announcement Management (Super Admin) -->
    <section class="page" id="page-admin-announcements" data-min-role="super_admin">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>系統公告管理</h2>
      </div>
      <div class="card-list" id="announcement-manage-list"></div>
      <button class="primary-btn full-width" style="margin:.5rem 0" onclick="App.showAnnouncementForm()">＋ 新增公告</button>
      <div class="form-card" id="announcement-form-card" style="display:none">
        <div class="role-editor-header"><span id="announcement-form-title">新增公告</span><button class="text-btn" onclick="App.hideAnnouncementForm()">取消</button></div>
        <div class="form-row"><label>公告標題</label><input type="text" id="ann-input-title" placeholder="例：系統維護通知"></div>
        <div class="form-row"><label>公告內容</label><textarea id="ann-input-content" rows="4" placeholder="公告內容..."></textarea></div>
        <div class="form-row"><label>發布方式</label><select id="ann-input-publish-type" onchange="App.toggleAnnSchedule()"><option value="now">立即發布</option><option value="scheduled">預約發布</option></select></div>
        <div class="form-row" id="ann-schedule-row" style="display:none"><label>預約發布時間</label><input type="datetime-local" id="ann-input-schedule"></div>
        <button class="primary-btn full-width" onclick="App.saveAnnouncementItem()">儲存</button>
      </div>
    </section>

    <!-- PAGE: Backend - Custom Roles (Super Admin) -->
    <section class="page" id="page-admin-roles" data-min-role="super_admin">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>自訂層級管理</h2>
      </div>
      <div class="role-hierarchy-card">
        <div class="role-hierarchy-title">目前層級架構</div>
        <div class="role-hierarchy-list" id="role-hierarchy-list"></div>
      </div>
      <div class="role-editor-card" id="role-editor-card" style="display:none">
        <div class="role-editor-header">
          <span id="role-editor-title">新增自訂層級</span>
          <button class="text-btn" onclick="document.getElementById('role-editor-card').style.display='none'">取消</button>
        </div>
        <div class="form-row"><label>層級名稱</label><input type="text" id="role-name-input" placeholder="例：裁判、助理教練"></div>
        <div class="form-row"><label>層級顏色</label><input type="color" id="role-color-input" value="#6366f1" style="width:100%;height:36px;border:none;cursor:pointer"></div>
        <div class="form-row">
          <label>插入位置（介於）</label>
          <select id="role-position-select"></select>
        </div>
        <div class="form-row">
          <label>權限設定</label>
          <div class="permissions-list" id="permissions-list"></div>
        </div>
        <button class="primary-btn full-width" onclick="App.showToast('層級已儲存（Demo）')">儲存層級</button>
      </div>
      <button class="primary-btn full-width" style="margin-top:.5rem" onclick="App.openRoleEditor()">＋ 新增自訂層級</button>
    </section>

    <!-- PAGE: Backend - Inactive Data (Super Admin) -->
    <section class="page" id="page-admin-inactive" data-min-role="super_admin">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>無效資料查詢</h2>
      </div>
      <div class="tab-bar">
        <button class="tab active">已解散球隊</button>
        <button class="tab">已結束賽事</button>
      </div>
      <div class="card-list" id="inactive-list"></div>
    </section>

    <!-- PAGE: Backend - Operation Logs (Super Admin) -->
    <section class="page" id="page-admin-logs" data-min-role="super_admin">
      <div class="page-header">
        <button class="back-btn" onclick="App.goBack()">←</button>
        <h2>操作日誌</h2>
      </div>
      <div class="admin-search">
        <input type="text" id="oplog-search" placeholder="搜尋操作者 / 目標..." oninput="App.filterOperationLogs()">
        <div class="admin-filters">
          <select id="oplog-type-filter" onchange="App.filterOperationLogs()"><option value="">全部類型</option><option value="exp">手動EXP</option><option value="role">晉升用戶</option><option value="event">活動管理</option></select>
        </div>
      </div>
      <div class="log-list" id="operation-log-list"></div>
    </section>

  </main>

  <!-- ============ BOTTOM TAB BAR ============ -->
  <nav id="bottom-tabs">
    <button class="bot-tab active" data-page="page-home">
      <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/></svg>
      <span>首頁</span>
    </button>
    <button class="bot-tab" data-page="page-activities">
      <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
      <span>活動</span>
    </button>
    <button class="bot-tab" data-page="page-teams">
      <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>
      <span>球隊</span>
    </button>
    <button class="bot-tab" data-page="page-tournaments">
      <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9H4.5a2.5 2.5 0 010-5C7 4 7 7 7 7"/><path d="M18 9h1.5a2.5 2.5 0 000-5C17 4 17 7 17 7"/><path d="M4 22h16"/><path d="M10 14.66V22"/><path d="M14 14.66V22"/><path d="M8 6v4a4 4 0 008 0V6H8z"/></svg>
      <span>賽事</span>
    </button>
    <button class="bot-tab" data-page="page-profile">
      <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
      <span>我的</span>
    </button>
  </nav>

  <!-- ============ POPUP AD OVERLAY ============ -->
  <div id="popup-ad-overlay" class="popup-ad-overlay" style="display:none" onclick="App.closePopupAd()">
    <div class="popup-ad-container" id="popup-ad-container" onclick="event.stopPropagation()">
      <button class="popup-ad-close" onclick="App.closePopupAd()">✕</button>
      <div class="popup-ad-body" id="popup-ad-body"></div>
      <div class="popup-ad-footer">
        <span class="popup-ad-counter" id="popup-ad-counter"></span>
        <button class="popup-ad-dismiss-btn" id="popup-ad-dismiss-btn" onclick="App.togglePopupDismiss()">今日不再顯示</button>
      </div>
    </div>
  </div>

  <!-- UID QR Code Popup -->
  <div id="uid-qr-modal" style="display:none;position:fixed;inset:0;z-index:1200;background:rgba(0,0,0,.5);backdrop-filter:blur(4px);align-items:center;justify-content:center" onclick="if(event.target===this)this.style.display='none'">
    <div style="background:var(--bg-card);border-radius:var(--radius-lg);max-width:320px;width:85%;padding:1.5rem;text-align:center;position:relative">
      <button style="position:absolute;top:.5rem;right:.7rem;background:none;border:none;font-size:1.2rem;cursor:pointer;color:var(--text-muted)" onclick="document.getElementById('uid-qr-modal').style.display='none'">✕</button>
      <div id="uid-qr-content"></div>
    </div>
  </div>

  <!-- ============ MODALS ============ -->
  <div class="modal-overlay" id="modal-overlay"></div>
  
  <!-- First Login Modal (forced) -->
  <div class="modal" id="first-login-modal">
    <div class="modal-header"><h3>完善個人資料</h3></div>
    <div class="modal-body">
      <p class="fl-hint">首次登入，請填寫以下基本資料</p>
      <div class="ce-form">
        <div class="ce-row">
          <label>性別 <span class="required">*必填</span></label>
          <select id="fl-gender"><option value="">請選擇</option><option value="男">男</option><option value="女">女</option><option value="其他">其他</option></select>
        </div>
        <div class="ce-row">
          <label>生日 <span class="required">*必填</span></label>
          <input type="date" id="fl-birthday">
        </div>
        <div class="ce-row">
          <label>地區 <span class="required">*必填</span></label>
          <select id="fl-region"><option value="">請選擇</option><option>台北市</option><option>新北市</option><option>桃園市</option><option>台中市</option><option>台南市</option><option>高雄市</option><option>其他</option></select>
        </div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="primary-btn" onclick="App.saveFirstLoginProfile()">確認送出</button>
    </div>
  </div>

  <!-- Social Link Edit Modal -->
  <div class="modal" id="social-link-modal">
    <div class="modal-header">
      <h3 id="social-modal-title">編輯社群連結</h3>
      <button class="modal-close" onclick="App.closeModal()">✕</button>
    </div>
    <div class="modal-body">
      <div class="ce-form">
        <div class="ce-row">
          <label id="social-modal-label">你的帳號 ID</label>
          <div class="social-url-row">
            <span class="social-url-prefix" id="social-url-prefix"></span>
            <input type="text" id="social-link-input" placeholder="your_id">
          </div>
        </div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="outline-btn" id="social-clear-btn" onclick="App.clearSocialLink()" style="color:var(--danger);border-color:var(--danger)">清除</button>
      <button class="primary-btn" onclick="App.saveSocialLink()">儲存</button>
    </div>
  </div>

  <div class="modal" id="rules-modal">
    <div class="modal-header">
      <h3>賽事規則</h3>
      <button class="modal-close" onclick="App.closeModal()">✕</button>
    </div>
    <div class="modal-body">
      <h4>積分規則</h4>
      <p>勝利：3分 ・ 平手：1分 ・ 落敗：0分</p>
      <h4>紅黃牌規則（預設英超）</h4>
      <p>累計 5 張黃牌 → 停賽 1 場<br>累計 10 張黃牌 → 停賽 2 場<br>直接紅牌 → 停賽 3 場（最低）</p>
      <h4>交易窗口</h4>
      <p>2026/03/01 ~ 2026/03/20</p>
    </div>
  </div>

  <div class="modal" id="confirm-modal">
    <div class="modal-header">
      <h3 id="confirm-title">確認操作</h3>
      <button class="modal-close" onclick="App.closeModal()">✕</button>
    </div>
    <div class="modal-body" id="confirm-body"></div>
    <div class="modal-actions">
      <button class="outline-btn" onclick="App.closeModal()">取消</button>
      <button class="primary-btn" onclick="App.closeModal()">確認</button>
    </div>
  </div>

  <!-- User Edit Modal -->
  <div class="modal" id="user-edit-modal">
    <div class="modal-header">
      <h3 id="user-edit-modal-title">編輯用戶</h3>
      <button class="modal-close" onclick="App.closeUserEditModal()">✕</button>
    </div>
    <div class="modal-body">
      <div class="ce-form">
        <div class="ce-row">
          <label>權限</label>
          <select id="ue-role">
            <option value="user">一般用戶</option>
            <option value="coach">教練</option>
            <option value="captain">領隊</option>
            <option value="venue_owner">場主</option>
          </select>
        </div>
        <div class="ce-row">
          <label>地區</label>
          <select id="ue-region">
            <option value="台北">台北</option><option value="新北">新北</option><option value="桃園">桃園</option>
            <option value="台中">台中</option><option value="台南">台南</option><option value="高雄">高雄</option><option value="其他">其他</option>
          </select>
        </div>
        <div class="ce-row">
          <label>性別</label>
          <select id="ue-gender">
            <option value="男">男</option><option value="女">女</option><option value="其他">其他</option>
          </select>
        </div>
        <div class="ce-row">
          <label>生日</label>
          <input type="date" id="ue-birthday">
        </div>
        <div class="ce-row">
          <label>運動類別</label>
          <input type="text" id="ue-sports" placeholder="例：足球、籃球">
        </div>
        <div class="ce-row">
          <label>聯繫電話</label>
          <input type="text" id="ue-phone" placeholder="例：0912-345-678">
        </div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="outline-btn" onclick="App.closeUserEditModal()">取消</button>
      <button class="primary-btn" onclick="App.saveUserEdit()">儲存</button>
    </div>
  </div>

  <!-- Create Event Modal -->
  <div class="modal" id="create-event-modal">
    <div class="modal-header">
      <h3>新增活動</h3>
      <button class="modal-close" onclick="App.closeModal()">✕</button>
    </div>
    <div class="modal-body">
      <div class="ce-form">
        <div class="ce-row">
          <label>活動封面圖片</label>
          <div class="ce-upload" id="ce-upload-area">
            <input type="file" id="ce-image" accept=".jpg,.jpeg,.png" hidden>
            <div class="ce-upload-placeholder" id="ce-upload-preview" onclick="document.getElementById('ce-image').click()">
              <span class="ce-upload-icon">+</span>
              <span class="ce-upload-text">點擊上傳圖片</span>
              <span class="ce-upload-hint">建議尺寸 800 × 300 px｜JPG / PNG｜最大 2MB</span>
            </div>
          </div>
        </div>
        <div class="ce-row">
          <label>活動名稱</label>
          <input type="text" id="ce-title" placeholder="例：週六足球友誼賽" maxlength="12">
        </div>
        <div class="ce-row">
          <label>活動類型</label>
          <select id="ce-type">
            <option value="friendly">友誼</option>
            <option value="camp">教學</option>
            <option value="play">PLAY</option>
            <option value="watch">觀賽</option>
          </select>
        </div>
        <div class="ce-row">
          <label>地點</label>
          <input type="text" id="ce-location" placeholder="例：台北市大安運動中心">
        </div>
        <div class="ce-row ce-row-half">
          <div>
            <label>日期</label>
            <input type="date" id="ce-date" value="2026-03-01">
          </div>
          <div>
            <label>時間</label>
            <div style="display:flex;gap:.3rem;align-items:center">
              <select id="ce-time-start" style="flex:1">
                <option value="06:00">06:00</option><option value="06:30">06:30</option>
                <option value="07:00">07:00</option><option value="07:30">07:30</option>
                <option value="08:00">08:00</option><option value="08:30">08:30</option>
                <option value="09:00">09:00</option><option value="09:30">09:30</option>
                <option value="10:00">10:00</option><option value="10:30">10:30</option>
                <option value="11:00">11:00</option><option value="11:30">11:30</option>
                <option value="12:00">12:00</option><option value="12:30">12:30</option>
                <option value="13:00">13:00</option><option value="13:30">13:30</option>
                <option value="14:00" selected>14:00</option><option value="14:30">14:30</option>
                <option value="15:00">15:00</option><option value="15:30">15:30</option>
                <option value="16:00">16:00</option><option value="16:30">16:30</option>
                <option value="17:00">17:00</option><option value="17:30">17:30</option>
                <option value="18:00">18:00</option><option value="18:30">18:30</option>
                <option value="19:00">19:00</option><option value="19:30">19:30</option>
                <option value="20:00">20:00</option><option value="20:30">20:30</option>
                <option value="21:00">21:00</option><option value="21:30">21:30</option>
                <option value="22:00">22:00</option><option value="22:30">22:30</option>
                <option value="23:00">23:00</option><option value="23:30">23:30</option>
              </select>
              <span style="font-size:.82rem;color:var(--text-muted)">~</span>
              <select id="ce-time-end" style="flex:1">
                <option value="06:00">06:00</option><option value="06:30">06:30</option>
                <option value="07:00">07:00</option><option value="07:30">07:30</option>
                <option value="08:00">08:00</option><option value="08:30">08:30</option>
                <option value="09:00">09:00</option><option value="09:30">09:30</option>
                <option value="10:00">10:00</option><option value="10:30">10:30</option>
                <option value="11:00">11:00</option><option value="11:30">11:30</option>
                <option value="12:00">12:00</option><option value="12:30">12:30</option>
                <option value="13:00">13:00</option><option value="13:30">13:30</option>
                <option value="14:00">14:00</option><option value="14:30">14:30</option>
                <option value="15:00">15:00</option><option value="15:30">15:30</option>
                <option value="16:00" selected>16:00</option><option value="16:30">16:30</option>
                <option value="17:00">17:00</option><option value="17:30">17:30</option>
                <option value="18:00">18:00</option><option value="18:30">18:30</option>
                <option value="19:00">19:00</option><option value="19:30">19:30</option>
                <option value="20:00">20:00</option><option value="20:30">20:30</option>
                <option value="21:00">21:00</option><option value="21:30">21:30</option>
                <option value="22:00">22:00</option><option value="22:30">22:30</option>
                <option value="23:00">23:00</option><option value="23:30">23:30</option>
                <option value="00:00">00:00</option><option value="00:30">00:30</option>
              </select>
            </div>
          </div>
        </div>
        <div class="ce-row ce-row-half">
          <div>
            <label>費用 ($)</label>
            <input type="number" id="ce-fee" placeholder="0" value="300">
          </div>
          <div>
            <label>人數上限</label>
            <input type="number" id="ce-max" placeholder="20" value="20">
          </div>
        </div>
        <div class="ce-row">
          <label>候補上限</label>
          <input type="number" id="ce-waitlist" placeholder="5" value="5">
        </div>
        <div class="ce-row">
          <label>年齡限制（歲以上，0 為不限）</label>
          <input type="number" id="ce-min-age" placeholder="0" value="0" min="0">
        </div>
        <div class="ce-row">
          <label>球隊限定</label>
          <div style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap">
            <label class="toggle-switch" style="margin:0">
              <input type="checkbox" id="ce-team-only">
              <span class="toggle-slider"></span>
            </label>
            <span id="ce-team-only-label" style="font-size:.78rem;color:var(--text-muted)">關閉 — 所有人可見</span>
            <select id="ce-team-select" style="display:none;font-size:.78rem;padding:.2rem .4rem;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--card-bg);color:var(--text-primary)"></select>
          </div>
        </div>
        <div class="ce-row">
          <label>委託人（最多 3 人）</label>
          <div class="ce-delegate-wrap">
            <div class="ce-delegate-tags" id="ce-delegate-tags"></div>
            <input type="text" id="ce-delegate-search" placeholder="搜尋 UID 或暱稱..." autocomplete="off">
            <div class="ce-delegate-dropdown" id="ce-delegate-dropdown"></div>
          </div>
        </div>
        <div class="ce-row">
          <label>注意事項（上限 500 字）</label>
          <textarea id="ce-notes" rows="3" maxlength="500" placeholder="例如：請自備球鞋、飲用水，遲到15分鐘以上視為缺席..."></textarea>
        </div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="outline-btn" onclick="App.closeModal()">取消</button>
      <button class="primary-btn" onclick="App.handleCreateEvent()">建立活動</button>
    </div>
  </div>

  <!-- Create Tournament Modal -->
  <div class="modal" id="create-tournament-modal">
    <div class="modal-header">
      <h3>新增賽事</h3>
      <button class="modal-close" onclick="App.closeModal()">✕</button>
    </div>
    <div class="modal-body">
      <div class="ce-form">
        <div class="ce-row">
          <label>賽事封面圖片</label>
          <div class="ce-upload" id="ct-upload-area">
            <input type="file" id="ct-image" accept=".jpg,.jpeg,.png" hidden>
            <div class="ce-upload-placeholder" id="ct-upload-preview" onclick="document.getElementById('ct-image').click()">
              <span class="ce-upload-icon">+</span>
              <span class="ce-upload-text">點擊上傳圖片</span>
              <span class="ce-upload-hint">建議尺寸 800 × 300 px｜JPG / PNG｜最大 2MB</span>
            </div>
          </div>
        </div>
        <div class="ce-row">
          <label>賽事名稱</label>
          <input type="text" id="ct-name" placeholder="例：2026 春季足球聯賽">
        </div>
        <div class="ce-row">
          <label>賽事類型</label>
          <select id="ct-type">
            <option value="聯賽（雙循環）">聯賽（雙循環）</option>
            <option value="盃賽（單敗淘汰）">盃賽（單敗淘汰）</option>
            <option value="盃賽（分組+淘汰）">盃賽（分組+淘汰）</option>
          </select>
        </div>
        <div class="ce-row ce-row-half">
          <div>
            <label>參賽隊伍數</label>
            <input type="number" id="ct-teams" value="8">
          </div>
          <div>
            <label>賽事狀態</label>
            <select id="ct-status">
              <option value="報名中">報名中</option>
              <option value="即將開始">即將開始</option>
              <option value="進行中">進行中</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="outline-btn" onclick="App.closeModal()">取消</button>
      <button class="primary-btn" onclick="App.handleCreateTournament()">建立賽事</button>
    </div>
  </div>

  <!-- Create Shop Item Modal -->
  <div class="modal" id="create-shop-modal">
    <div class="modal-header">
      <h3>新增二手商品</h3>
      <button class="modal-close" onclick="App.closeModal()">✕</button>
    </div>
    <div class="modal-body">
      <div class="ce-form">
        <div class="ce-row">
          <label>商品圖片（最多 3 張）</label>
          <div class="cs-img-row">
            <div class="cs-img-upload">
              <input type="file" id="cs-img1" accept=".jpg,.jpeg,.png" hidden>
              <div class="ce-upload-placeholder cs-preview" id="cs-preview1" onclick="document.getElementById('cs-img1').click()">
                <span class="ce-upload-icon">+</span>
                <span class="ce-upload-hint">JPG/PNG 2MB</span>
              </div>
            </div>
            <div class="cs-img-upload">
              <input type="file" id="cs-img2" accept=".jpg,.jpeg,.png" hidden>
              <div class="ce-upload-placeholder cs-preview" id="cs-preview2" onclick="document.getElementById('cs-img2').click()">
                <span class="ce-upload-icon">+</span>
                <span class="ce-upload-hint">JPG/PNG 2MB</span>
              </div>
            </div>
            <div class="cs-img-upload">
              <input type="file" id="cs-img3" accept=".jpg,.jpeg,.png" hidden>
              <div class="ce-upload-placeholder cs-preview" id="cs-preview3" onclick="document.getElementById('cs-img3').click()">
                <span class="ce-upload-icon">+</span>
                <span class="ce-upload-hint">JPG/PNG 2MB</span>
              </div>
            </div>
          </div>
          <span class="ce-upload-hint" style="margin-top:.2rem">建議尺寸 400 × 300 px｜JPG / PNG｜每張最大 2MB</span>
        </div>
        <div class="ce-row">
          <label>商品名稱</label>
          <input type="text" id="cs-name" placeholder="例：Nike Phantom GT2" maxlength="20">
        </div>
        <div class="ce-row ce-row-half">
          <div>
            <label>新舊程度</label>
            <select id="cs-condition">
              <option value="全新">全新</option>
              <option value="9成新" selected>9成新</option>
              <option value="8成新">8成新</option>
              <option value="7成新">7成新</option>
              <option value="6成新以下">6成新以下</option>
            </select>
          </div>
          <div>
            <label>價格 (NT$)</label>
            <input type="number" id="cs-price" placeholder="0" max="999999">
          </div>
        </div>
        <div class="ce-row">
          <label>尺寸 / 規格</label>
          <input type="text" id="cs-size" placeholder="例：US10、L、M">
        </div>
        <div class="ce-row">
          <label>商品描述（上限 500 字）</label>
          <textarea id="cs-desc" rows="4" maxlength="500" placeholder="描述商品狀況、使用次數、附贈配件等..."></textarea>
        </div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="outline-btn" onclick="App.closeModal()">取消</button>
      <button class="primary-btn" onclick="App.handleSaveShopItem()">上架商品</button>
    </div>
  </div>

  <!-- Create Team Modal -->
  <div class="modal" id="create-team-modal">
    <div class="modal-header">
      <h3 id="ct-team-modal-title">新增球隊</h3>
      <button class="modal-close" onclick="App.closeModal()">✕</button>
    </div>
    <div class="modal-body">
      <div class="ce-form">
        <div class="ce-row">
          <label>球隊封面</label>
          <div class="ce-upload-placeholder" id="ct-team-preview" onclick="document.getElementById('ct-team-image').click()">
            <span class="ce-upload-icon">+</span>
            <span class="ce-upload-text">點擊上傳封面圖片</span>
            <span class="ce-upload-hint">建議尺寸 800 × 300 px｜JPG / PNG｜最大 2MB</span>
          </div>
          <input type="file" id="ct-team-image" accept=".jpg,.jpeg,.png" hidden>
        </div>
        <div class="ce-row">
          <label>球隊名稱（最多 10 字）</label>
          <input type="text" id="ct-team-name" maxlength="10" placeholder="例：雷霆隊">
        </div>
        <div class="ce-row">
          <label>英文名稱</label>
          <input type="text" id="ct-team-name-en" placeholder="例：Thunder FC">
        </div>
        <div class="ce-row" style="display:flex;gap:.5rem">
          <div style="flex:1">
            <label>國籍</label>
            <input type="text" id="ct-team-nationality" maxlength="20" placeholder="例：台灣" value="台灣">
          </div>
          <div style="flex:1">
            <label>地區</label>
            <input type="text" id="ct-team-region" maxlength="20" placeholder="例：台北市">
          </div>
        </div>
        <div class="ce-row">
          <label>創立年份</label>
          <input type="number" id="ct-team-founded" min="1900" max="2099" placeholder="例：2024">
        </div>
        <div class="ce-row" id="ct-captain-row" style="position:relative">
          <label>領隊</label>
          <div id="ct-captain-display" style="font-size:.85rem;font-weight:600;color:var(--text-primary);padding:.3rem 0"></div>
          <div id="ct-captain-transfer" style="display:none">
            <div style="font-size:.75rem;color:var(--text-muted);margin-bottom:.3rem">轉移領隊：搜尋新領隊後點選</div>
            <input type="text" id="ct-captain-search" placeholder="搜尋 UID 或暱稱..." oninput="App.searchTeamCaptain()" autocomplete="off">
            <div class="team-user-suggest" id="ct-captain-suggest"></div>
            <div id="ct-captain-selected"></div>
          </div>
        </div>
        <div class="ce-row">
          <label>聯繫方式</label>
          <input type="text" id="ct-team-contact" maxlength="100" placeholder="例：LINE ID、電話、Email">
        </div>
        <div class="ce-row" style="position:relative">
          <label>教練（可多位）</label>
          <input type="text" id="ct-coach-search" placeholder="搜尋 UID 或暱稱..." oninput="App.searchTeamCoach()" autocomplete="off">
          <div class="team-user-suggest" id="ct-coach-suggest"></div>
          <div id="ct-coach-tags"></div>
        </div>
        <div class="ce-row">
          <label>球隊簡介</label>
          <textarea id="ct-team-bio" maxlength="500" rows="3" placeholder="簡短介紹球隊（最多 500 字）"></textarea>
        </div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="outline-btn" onclick="App.closeModal()">取消</button>
      <button class="primary-btn" id="ct-team-save-btn" onclick="App.handleSaveTeam()">建立球隊</button>
    </div>
  </div>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" onclick="App.closeLightbox()">
    <img id="lightbox-img" src="" alt="">
    <button class="lightbox-close">✕</button>
  </div>

  <!-- Mode Badge (DEMO indicator) -->
  <div id="mode-badge" class="mode-badge">DEMO</div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Loading Overlay (Firebase init) -->
  <div id="loading-overlay" class="loading-overlay" style="display:none">
    <div class="loading-spinner"></div>
    <div style="margin-top:.8rem;font-size:.85rem;color:var(--text-secondary)">載入中...</div>
  </div>

  <!-- Firebase SDK (compat v10 CDN) -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>

  <!-- LINE LIFF SDK -->
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <!-- QR Code Scanner -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <!-- QR Code Generator (local) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>

  <!-- 基礎層 -->
  <script src="js/config.js"></script>
  <script src="js/data.js"></script>
  <script src="js/firebase-config.js"></script>
  <script src="js/firebase-service.js"></script>
  <script src="js/api-service.js"></script>
  <script src="js/line-auth.js"></script>

  <!-- 核心（定義 App 物件 + init/renderAll/showToast） -->
  <script src="app.js"></script>

  <!-- 核心擴充 -->
  <script src="js/core/navigation.js"></script>
  <script src="js/core/theme.js"></script>
  <script src="js/core/mode.js"></script>

  <!-- 功能模組 -->
  <script src="js/modules/image-upload.js"></script>
  <script src="js/modules/role.js"></script>
  <script src="js/modules/profile.js"></script>
  <script src="js/modules/banner.js"></script>
  <script src="js/modules/ad-manage.js"></script>
  <script src="js/modules/popup-ad.js"></script>
  <script src="js/modules/announcement.js"></script>
  <script src="js/modules/event.js"></script>
  <script src="js/modules/tournament.js"></script>
  <script src="js/modules/team.js?v=2"></script>
  <script src="js/modules/message.js"></script>
  <script src="js/modules/achievement.js"></script>
  <script src="js/modules/shop.js"></script>
  <script src="js/modules/leaderboard.js"></script>
  <script src="js/modules/user-admin.js"></script>
  <script src="js/modules/scan.js"></script>
</body>
</html>
